# Калькулятор на WinAPI

Научный калькулятор, построенный на чистом Win32 API без использования MFC. Поддерживает различные форматы чисел, бинарные операции с настраиваемой разрядностью и расширенные математические функции.

## Возможности

- **Научный калькулятор**: Поддержка тригонометрических функций, логарифмов, экспонент и многого другого
- **Парсер выражений**: Расширенное вычисление математических выражений с правильным приоритетом операторов
- **История вычислений**: Отслеживание предыдущих вычислений с быстрым доступом через выпадающее меню (автосохранение при выходе)
- **DPI Awareness**: Автоматическое масштабирование для дисплеев с высоким разрешением
- **Поддержка CHM справки**: Интеграция F1 для внешних файлов справки
- **Стандартный интерфейс Windows**: Встроенные меню, горячие клавиши и поддержка буфера обмена
- **Множество форматов вывода**: Отображение результатов в десятичном, шестнадцатеричном, восьмеричном, двоичном, научном формате и т.д.
- **Настраиваемая разрядность**: Выбор разрядности двоичного отображения от 8 до 64 бит
- **Диалог переменных**: Просмотр и управление переменными вычислений
- **Настраиваемые опции**: Чувствительность к регистру, режим принудительного float, минимизация по ESC, управление прозрачностью
- **Неявное умножение**: Возможность опускать оператор умножения в типичных случаях

## Поддерживаемые функции

### Базовые операции

- Сложение (+), Вычитание (-), Умножение (*), Деление (/)
- Остаток от деления (%), Возведение в степень (^)
- Скобки для группировки

### Математические функции

- **Тригонометрические**: sin, cos, tan, asin, acos, atan
- **Гиперболические**: sinh, cosh, tanh
- **Логарифмические**: ln (натуральный логарифм), log (по основанию 10)
- **Другие**: sqrt, exp, abs, floor, ceil, round

### Поддержка комплексных чисел

- Все математические операции и функции (включая тригонометрические, гиперболические, экспоненциальные, логарифмические, степенные и извлечение корня) поддерживают комплексные аргументы и возвращают комплексные результаты там, где это применимо.
- Комплексные числа можно вводить в форме `a+bi` (например, `1+2i`, `3-4i`).
- Функции `sin`, `cos`, `exp`, `abs` и другие работают как с действительными, так и с комплексными аргументами.
- Результат отображается в форме `a+bi`, если мнимая часть ненулевая.

### Константы

- **pi**: 3.14159265358979323846
- **e**: 2.71828182845904523536
- **phi**: 1.61803398874989484820 (золотое сечение)

## Форматы вывода

- Научный
- Нормализованный
- Дробный
- Вычислительный
- Целочисленный
- Беззнаковый
- Шестнадцатеричный
- Восьмеричный
- Двоичный (настраиваемая разрядность)
- Символьный
- Широкий символ
- Дата/Время
- Unix Timestamp
- Градусы
- Строка
- Дюймы
- Автоматический

## Использование

1. Вводите математические выражения в поле ввода
2. Результаты вычисляются автоматически по мере ввода
3. Нажмите Enter, чтобы добавить вычисление в историю
4. Используйте выпадающее меню истории для вызова предыдущих вычислений
5. Копируйте результаты с помощью Ctrl+C или вставляйте выражения с помощью Ctrl+V
6. Доступ к параметрам форматирования и настройкам разрядности через меню Calc

### Примеры выражений

```bash
2 + 3 * 4
sin(pi/2)
sqrt(16) + log(100)
2^3 * e
(5 + 3) / (2 - 1)

# С включенным неявным умножением:
2sin(pi/2)          # То же, что 2 * sin(pi/2) = 2
3(4+5)              # То же, что 3 * (4+5) = 27
(1+2)(3+4)          # То же, что (1+2) * (3+4) = 21
2PI                 # То же, что 2 * PI ≈ 6.28 (PI в верхнем регистре, чтобы избежать суффикса pico)
3e                  # То же, что 3 * e ≈ 8.15 (E в верхнем регистре - это постфикс exa, 10¹⁸)
```

### Неявное умножение

Когда **неявное умножение** включено (через меню Calc), можно опускать оператор `*` в следующих типичных случаях:

1. **Число перед функцией**: `2sin(x)` → `2 * sin(x)`
2. **Число перед скобкой**: `3(4+5)` → `3 * (4+5)`
3. **Скобка после скобки**: `(1+2)(3+4)` → `(1+2) * (3+4)`
4. **Число перед переменной/константой**: `2PI` → `2 * PI` (рекомендуется верхний регистр)

**Важные замечания о научных суффиксах и мнимой единице:**

- Эта функция **отключена по умолчанию** — включите её через меню **Calc → Implicit multiplication**.
- **Научные суффиксы имеют наивысший приоритет**: Однобуквенные суффиксы (k, M, G, m, u, n, **p**, f, a и т.д.) распознаются первыми, если за ними следует пробел, оператор или конец выражения.
  - `3k` → `3×10³` = 3000 (кило)
  - `3p` → `3×10⁻¹²` = 3e-12 (пико)
  - `3p+5` → `3×10⁻¹² + 5` (суффикс pico применяется)
  
- **Строчные `i` и `j` зарезервированы для мнимой единицы**: Они распознаются **после** научных суффиксов.
  - `5i` → `0+5i` (мнимое число, а не переменная `5 * i`)
  - `5j` → `0+5j` (альтернативная запись мнимой единицы)
  - `3pi` → `0+3e-12i` (интерпретируется как 3 пико + мнимая единица `i`)
  
- **Используйте верхний регистр для переменных, чтобы избежать конфликтов**:
  - `3PI` → `3 * PI` ≈ 9.42 (неявное умножение с константой PI)
  - `3pI` → `3 * pI` (также работает: `p` перед заглавной `I` не является суффиксом pico)
  - `5I` → `5 * I` (заглавная `I` как переменная, а не мнимая единица)

- **Pas style / C style**: Переключение между синтаксисом Pascal (использовать `^` для степени, `:=` для присваивания) и C
- **Case sensitive**: Переключить чувствительность к регистру для переменных/функций
- **Forced float**: Принудительно использовать формат с плавающей точкой для всех результатов
- **Implicit multiplication**: Разрешить опускать оператор `*` (например, `2sin(x)`, `3PI`)
- **ESC minimized**: Сворачивать окно по клавише ESC
- **Always on top**: Держать окно калькулятора поверх других окон
- **Opacity**: Настроить прозрачность окна
- Подменю Format: Выбрать формат вывода
- Подменю Binary width: Выбрать разрядность двоичного отображения (8, 16, 24, 32, 48, 64 бита)
- View variables: Открыть диалог переменных
- Exit: Закрыть приложение

### Edit

- Copy: Копировать текущий результат
- Paste: Вставить текст в поле выражения
- Clear History: Удалить все элементы истории

### View

- Standard Mode: Базовый интерфейс калькулятора
- Scientific Mode: Расширенные научные функции

### Help

- Help Contents: Открыть файл CHM справки (F1)
- About: Информация о приложении

## Требования для сборки

- Visual Studio 2019 или новее
- Windows SDK 10.0 или новее
- Стандарт C++17

## Зависимости

- comctl32.lib (Windows Common Controls)
- htmlhelp.lib (поддержка CHM справки)

## Архитектура

Приложение использует четкое разделение обязанностей:

- **WinApiCalc**: Главное окно приложения и управление UI
- **Calculator**: Парсер и вычислитель математических выражений
- **Resources**: Меню, диалоги и акселераторы

## Интеграция файла справки

Разместите файл CHM справки как `fcalc.chm` в том же каталоге, что и исполняемый файл, чтобы включить функциональность справки по F1.

## Лицензия

Copyright (C) 2024. Все права защищены.